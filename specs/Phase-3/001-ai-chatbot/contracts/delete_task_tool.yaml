mcp_tool: delete_task
version: 1.0.0
description: |
  Permanently delete a task from the database.
  Use when user wants to remove, delete, or get rid of a task.

parameters:
  type: object
  required:
    - user_id
    - task_id
  properties:
    user_id:
      type: integer
      minimum: 1
      description: ID of the user who owns the task (from JWT token)
      example: 5
    task_id:
      type: integer
      minimum: 1
      description: ID of the task to delete
      example: 42

returns:
  type: object
  required:
    - task_id
    - deleted
    - title
  properties:
    task_id:
      type: integer
      description: ID of the deleted task (for confirmation)
      example: 42
    deleted:
      type: boolean
      description: Deletion confirmation (always true if successful)
      example: true
    title:
      type: string
      description: Title of deleted task (for confirmation message)
      example: "Buy milk"

errors:
  - code: "TASK_NOT_FOUND"
    message: "Task not found"
    http_status: 404
    condition: "task_id does not exist OR task belongs to different user"
    security_note: "Do not reveal whether task exists for another user"

examples:
  - name: "Delete existing task"
    input:
      user_id: 5
      task_id: 42
    output:
      task_id: 42
      deleted: true
      title: "Buy milk"

  - name: "Delete non-existent task (error)"
    input:
      user_id: 5
      task_id: 999
    error:
      code: "TASK_NOT_FOUND"
      message: "Task not found"

  - name: "Delete another user's task (security)"
    input:
      user_id: 5
      task_id: 100  # Belongs to user_id 7
    error:
      code: "TASK_NOT_FOUND"
      message: "Task not found"
    security_note: "Same error as non-existent task to prevent enumeration"

agent_usage:
  trigger_phrases:
    - "Delete task"
    - "Remove task"
    - "Get rid of"
    - "Cancel task"
    - "Discard task"
  natural_language_examples:
    - user_input: "Delete task 7"
      extracted_parameters:
        task_id: 7
    - user_input: "Remove the milk task"
      agent_behavior: |
        1. Agent calls list_tasks to find task with title containing "milk"
        2. Extracts task_id from result
        3. Calls delete_task with extracted task_id
    - user_input: "Get rid of the first completed task"
      agent_behavior: |
        1. Agent calls list_tasks with status="completed"
        2. Identifies first task
        3. Calls delete_task with that task_id

validation:
  - rule: "user_id must be a positive integer"
    enforcement: "Parameter type validation"
  - rule: "task_id must be a positive integer"
    enforcement: "Parameter type validation"
  - rule: "Task must belong to authenticated user"
    enforcement: "Database query: WHERE task_id = ? AND user_id = ?"

security:
  - check: "user_id from parameters MUST match authenticated user from JWT"
    enforcement: "Endpoint-level JWT validation"
    consequence: "403 Forbidden if mismatch"
  - check: "Task ownership verification"
    enforcement: "WHERE task_id = ? AND user_id = ?"
    consequence: "404 Task not found if ownership mismatch (prevent enumeration)"
  - check: "No cross-user deletion"
    enforcement: "User isolation at query level"
    consequence: "Users cannot delete others' tasks"
  - check: "Permanent deletion (no soft delete in Phase 3)"
    enforcement: "DELETE FROM tasks WHERE id = ? AND user_id = ?"
    consequence: "Task is permanently removed (no recovery)"

performance:
  expected_execution_time: "<50ms"
  database_operations: 2
  operation_details:
    - "SELECT to fetch task title before deletion (for confirmation)"
    - "DELETE FROM tasks WHERE id = ? AND user_id = ?"
  query_optimization: "Index on (id, user_id) for fast lookup"

idempotency: false
idempotency_behavior: |
  Deleting a non-existent task returns 404 error (not idempotent).
  Consider soft deletes (deleted_at timestamp) for idempotency in future.
side_effects: "Permanently removes row from tasks table (cannot be undone)"
stateless: true

warnings:
  - "Deletion is permanent in Phase 3 (no soft deletes)"
  - "No undo/recovery mechanism"
  - "Agent should ask confirmation for important tasks (future enhancement)"
