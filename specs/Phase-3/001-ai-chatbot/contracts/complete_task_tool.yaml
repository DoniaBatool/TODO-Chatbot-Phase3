mcp_tool: complete_task
version: 1.0.0
description: |
  Mark a task as completed (set completed = true).
  Use when user indicates they finished, completed, or are done with a task.

parameters:
  type: object
  required:
    - user_id
    - task_id
  properties:
    user_id:
      type: integer
      minimum: 1
      description: ID of the user who owns the task (from JWT token)
      example: 5
    task_id:
      type: integer
      minimum: 1
      description: ID of the task to mark as completed
      example: 42

returns:
  type: object
  required:
    - task_id
    - title
    - completed
    - updated_at
  properties:
    task_id:
      type: integer
      description: ID of the completed task
      example: 42
    title:
      type: string
      description: Task title (for confirmation message)
      example: "Buy milk"
    completed:
      type: boolean
      description: Completion status (always true after this operation)
      example: true
    updated_at:
      type: string
      format: date-time
      description: ISO 8601 timestamp of when task was marked complete
      example: "2025-12-30T14:30:00Z"

errors:
  - code: "TASK_NOT_FOUND"
    message: "Task not found"
    http_status: 404
    condition: "task_id does not exist OR task belongs to different user"
    security_note: "Do not reveal whether task exists for another user (prevent enumeration)"
  - code: "USER_NOT_FOUND"
    message: "User not found"
    http_status: 404
    condition: "user_id does not exist in database"

examples:
  - name: "Complete a pending task"
    input:
      user_id: 5
      task_id: 42
    output:
      task_id: 42
      title: "Buy milk"
      completed: true
      updated_at: "2025-12-30T14:30:00Z"

  - name: "Complete already completed task (idempotent)"
    input:
      user_id: 5
      task_id: 43
    output:
      task_id: 43
      title: "Call mom"
      completed: true
      updated_at: "2025-12-30T14:30:00Z"
    note: "No error, idempotent operation"

  - name: "Complete task that doesn't exist"
    input:
      user_id: 5
      task_id: 999
    error:
      code: "TASK_NOT_FOUND"
      message: "Task not found"

  - name: "Complete another user's task (security)"
    input:
      user_id: 5
      task_id: 100  # Belongs to user_id 7
    error:
      code: "TASK_NOT_FOUND"
      message: "Task not found"
    security_note: "Same error as non-existent task to prevent enumeration"

agent_usage:
  trigger_phrases:
    - "Mark task complete"
    - "Complete task"
    - "I finished"
    - "Done with"
    - "Task is done"
    - "Mark as done"
  natural_language_examples:
    - user_input: "Mark task 5 as complete"
      extracted_parameters:
        task_id: 5
    - user_input: "I finished buying milk"
      agent_behavior: |
        1. Agent calls list_tasks to find task with title containing "milk"
        2. Extracts task_id from result
        3. Calls complete_task with extracted task_id
    - user_input: "Complete the first task"
      agent_behavior: |
        1. Agent calls list_tasks to get all tasks
        2. Identifies first pending task
        3. Calls complete_task with that task_id

validation:
  - rule: "user_id must be a positive integer"
    enforcement: "Parameter type validation"
  - rule: "task_id must be a positive integer"
    enforcement: "Parameter type validation"
  - rule: "Task must belong to authenticated user"
    enforcement: "Database query: WHERE task_id = ? AND user_id = ?"

security:
  - check: "user_id from parameters MUST match authenticated user from JWT"
    enforcement: "Endpoint-level JWT validation"
    consequence: "403 Forbidden if mismatch"
  - check: "Task ownership verification"
    enforcement: "WHERE task_id = ? AND user_id = ?"
    consequence: "404 Task not found if ownership mismatch (prevent enumeration)"
  - check: "No cross-user completion"
    enforcement: "User isolation at query level"
    consequence: "Users cannot complete others' tasks"

performance:
  expected_execution_time: "<50ms"
  database_operations: 1
  operation_type: "UPDATE tasks SET completed = true WHERE id = ? AND user_id = ?"
  query_optimization: "Index on (id, user_id) for fast lookup"

idempotency: true
idempotency_behavior: |
  Completing an already-completed task returns success (no error).
  The completed field remains true, updated_at is refreshed.
side_effects: "Updates tasks.completed and tasks.updated_at"
stateless: true
